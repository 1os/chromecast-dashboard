<html>
  <head>
    <title>Dashboard</title>
    <style>
    body {
      margin: 0;
      padding: 0;
      background-image: -webkit-radial-gradient(center center, circle cover, #eee, #ccc);
    }

    #dashboard {
      width: 100%;
      height: 100%;
      border: 0;
    }
    </style>
    <link rel="stylesheet" href='http://fonts.googleapis.com/css?family=Cabin+Condensed:700'>
    <link rel="stylesheet" href='loading.css'>
  </head>
  <body>
    <iframe id="dashboard" scrolling="no"></iframe>
    <div class="loading wave">Loading</div>
  </body>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
  <script src="https://www.gstatic.com/cast/js/receiver/1.0/cast_receiver.js"></script>
  <script src="messageTypes.js"></script>
  <script>
  $(function() {
    var receiver = new cast.receiver.Receiver('2c6e7388-90e6-422f-a9d8-4188399c8d5a', ['boombatower']);
    var channelHandler = new cast.receiver.ChannelHandler('boombatower');
    channelHandler.addChannelFactory(receiver.createChannelFactory('boombatower'));
    receiver.start();
    channelHandler.addEventListener(cast.receiver.Channel.EventType.MESSAGE, onMessage.bind(this));

    function onMessage(event) {
      var message = event.message;
      if (message.type == 'load') {
        $('#dashboard').attr('src', message.url);
        if (message.refresh > 0) {
          $('#dashboard').attr('data-refresh', message.refresh * 1000);
          setTimeout(reloadDashboard, $('#dashboard').attr('data-refresh'));
        }
        else {
          $('#dashboard').attr('data-refresh', 0);
        }
      }
    }

    function reloadDashboard() {
      $('#dashboard').attr('src', $('#dashboard').attr('src'));
      if ($('#dashboard').attr('data-refresh')) {
        setTimeout(reloadDashboard, $('#dashboard').attr('data-refresh'));
      }
    }
  });
  </script>
</html>
